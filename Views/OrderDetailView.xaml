<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:BanHangVip.ViewModels"
             xmlns:models="clr-namespace:BanHangVip.Models"
             xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
             x:Class="BanHangVip.Views.OrderDetailView"
             Title="Chi tiết đơn hàng"
             BackgroundColor="#f8fafc"
             Shell.NavBarIsVisible="False"
             ios:Page.UseSafeArea="True">

    <Grid RowDefinitions="Auto, *, Auto">
        <!-- Header -->
        <Grid Grid.Row="0" Padding="15,15" BackgroundColor="White" ColumnDefinitions="Auto, *">
            <Border StrokeShape="RoundRectangle 20" BackgroundColor="Transparent" StrokeThickness="0" HeightRequest="40" WidthRequest="40" Padding="0">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoBackCommand}"/>
                </Border.GestureRecognizers>
                <Path Data="M20,11H7.83l5.59-5.59L12,4l-8,8l8,8l1.41-1.41L7.83,13H20V11z" Fill="#1e293b" Aspect="Uniform" HeightRequest="24" WidthRequest="24" HorizontalOptions="Center" VerticalOptions="Center"/>
            </Border>
            <Label Grid.Column="1" Text="Chi tiết đơn hàng" TextColor="#1e293b" FontAttributes="Bold" FontSize="20" VerticalOptions="Center" Margin="10,0,0,0"/>
        </Grid>

        <!-- Content -->
        <ScrollView Grid.Row="1" Padding="15">
            <VerticalStackLayout Spacing="20">
                <!-- Info Card -->
                <Border StrokeShape="RoundRectangle 20" BackgroundColor="White" Padding="20" StrokeThickness="0">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="{Binding Order.CustomerName}" FontSize="22" FontAttributes="Bold" TextColor="#0369a1"/>
                        <Label Text="{Binding Order.Id, StringFormat='Mã đơn: {0}'}" TextColor="#94a3b8" FontSize="12"/>
                        <Label Text="{Binding Order.CreatedAt, StringFormat='Thời gian: {0:dd/MM/yyyy HH:mm}'}" TextColor="#64748b" FontSize="14"/>
                        <BoxView HeightRequest="1" Color="#f1f5f9" Margin="0,5"/>
                        <Grid ColumnDefinitions="*, Auto">
                            <Label Text="Trạng thái" TextColor="#64748b"/>
                            <Label Text="{Binding Order.Status}" TextColor="#e11d48" FontAttributes="Bold"/>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Items List -->
                <Label Text="Danh sách món" TextColor="#1e293b" FontAttributes="Bold" FontSize="16"/>
                <StackLayout BindableLayout.ItemsSource="{Binding Order.Items}" Spacing="10">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:OrderItem">
                            <Border StrokeShape="RoundRectangle 15" BackgroundColor="White" Padding="15" StrokeThickness="0">
                                <Grid ColumnDefinitions="*, Auto">
                                    <VerticalStackLayout>
                                        <Label Text="{Binding ProductName}" FontAttributes="Bold" TextColor="#334155"/>
                                        <Label Text="{Binding Price, StringFormat='{0:N0} đ/kg'}" FontSize="12" TextColor="#94a3b8"/>
                                    </VerticalStackLayout>
                                    <VerticalStackLayout Grid.Column="1" HorizontalOptions="End">
                                        <Label Text="{Binding Weight, StringFormat='{0:F1} kg'}" FontAttributes="Bold" TextColor="#0369a1" HorizontalOptions="End"/>
                                        <Label Text="{Binding Total, StringFormat='{0:N0} đ'}" FontSize="12" TextColor="#64748b" HorizontalOptions="End"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </StackLayout>

                <!-- Summary -->
                <Border StrokeShape="RoundRectangle 20" BackgroundColor="#f0f9ff" Padding="20" StrokeThickness="0">
                    <Grid ColumnDefinitions="*, Auto">
                        <Label Text="TỔNG CỘNG" FontAttributes="Bold" TextColor="#0369a1" VerticalOptions="Center"/>
                        <Label Text="{Binding Order.TotalValue, StringFormat='{0:N0} đ'}" FontSize="24" FontAttributes="Bold" TextColor="#0369a1" VerticalOptions="Center"/>
                    </Grid>
                </Border>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Footer Actions -->
        <Grid Grid.Row="2" ColumnDefinitions="*, *" Padding="15" ColumnSpacing="15" BackgroundColor="White">
            <Button Text="HỦY ĐƠN" BackgroundColor="#fee2e2" TextColor="#ef4444" FontAttributes="Bold" Command="{Binding CancelOrderCommand}" HeightRequest="50" CornerRadius="12"/>
            <Button Grid.Column="1" Text="IN HÓA ĐƠN" BackgroundColor="#0369a1" TextColor="White" FontAttributes="Bold" Command="{Binding PrintInvoiceCommand}" HeightRequest="50" CornerRadius="12"/>
        </Grid>
    </Grid>
</ContentPage>